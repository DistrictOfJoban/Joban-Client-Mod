plugins {
//	id "com.github.johnrengelman.shadow" version "+" apply false
}

subprojects {
	apply plugin: "java"
//	apply plugin: "com.github.johnrengelman.shadow"

	group project.maven_group
	version "${rootProject.properties.mod_version}+${rootProject.properties.minecraft_version}"

	configurations {
//		shadowImplementation
//		implementation.extendsFrom shadowImplementation
	}

	dependencies {
		annotationProcessor 'systems.manifold:manifold-preprocessor:+'
		implementation 'com.google.code.findbugs:jsr305:+'
		implementation "org.mtr:Minecraft-Mappings-common:0.0.1"
	}

	repositories {
		flatDir { dirs "../libs" }
	}
//
//	shadowJar {
//		minimize()
//		configurations = [project.configurations.shadowImplementation]
//		enableRelocation = false
//		relocationPrefix = "com.lx862.jcm.lib"
//	}

	/* Manifold support */
	tasks.withType(JavaCompile).forEach {
		def mc_ver = rootProject.properties.minecraft_version
		def mc_major = mc_ver.split("\\.")[0]
		def mc_main = mc_ver.split("\\.")[1]
		def mc_minor = mc_ver.split("\\.").size() > 2 ? (mc_ver.split("\\.")[2] as String).padLeft(2, '0') : 0
		def manifold_mc_version = "$mc_major$mc_main$mc_minor"

		it.options.compilerArgs += [
				"-Xplugin:Manifold",
				"-AMC_VERSION=$manifold_mc_version",
				"-ALOADER=$project.properties.loader_name"
		]
	}
}